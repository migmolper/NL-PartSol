#include <stdio.h>
#include <stdlib.h>
#include "AllocateTools.h"

typedef struct Element{  
  double * (* n)(double * ); /* Shape function */
  double ** (* dn)(double * ); /* Derivative shape function */
  double ** (* J)(double * ); /* Jacobian of the Element */
};


double * Q4(double * X_e){
  double * n = (double *)AllocateArray(4,sizeof(double)); 
  n[0] = 1 - X_e[0] - X_e[1] + X_e[0]*X_e[1];
  n[1] = X_e[0] - X_e[0]*X_e[1];
  n[2] = X_e[0]*X_e[1];
  n[3] = X_e[1] - X_e[1]*X_e[0];
  return n;
}


double ** dQ4(double * X_e){
  double ** dn = (double **)AllocateArray(4,2,sizeof(double));
  dn[0][0] = X_e[1] - 1;
  dn[1][0] = 1 - X_e[1];
  dn[2][0] = X_e[1];
  dn[3][0] = - X_e[1];

  dn[0][1] = X_e[0] - 1;
  dn[1][1] = - X_e[0];
  dn[2][1] = X_e[0];
  dn[3][1] = 1 - X_e[0];
  return dn;
}


Element DefineElement(char TypeElement){
  
#if DIMENSION == 2

  Element E2D;
  
  if (TypeElement=='Q4'){
    E2D.n = Q4;
    E2D.dn = dQ4;
  }
  return E2D;
  
#endif
}
